<!-- Title -->
<div class="mt-8 text-2xl font-extrabold tracking-tight leading-tight">
    Datos para afiliarme
</div>

<!-- Alert -->
<fuse-alert
    class="mt-8 -mb-4"
    *ngIf="showAlert"
    [appearance]="'outline'"
    [showIcon]="false"
    [type]="alert.type"
    [@shake]="alert.type === 'error'"
>
    {{ alert.message }}
</fuse-alert>

<!-- Sign in form -->
<form class="mt-8 w-full" [formGroup]="personalInformationForm">
    <div formGroupName="personalInformation">
        <div class="grid grid-cols-1 md:grid-cols-3">
            <!-- Document type field -->
            <mat-form-field class="md:mr-1 w-full">
                <mat-select
                    id="documentType"
                    placeholder="Documento"
                    [formControlName]="'documentType'"
                >
                    <mat-option
                        *ngFor="let documentIdType of documentIdTypes$ | async"
                        [value]="documentIdType.nu_id_tipo_doc_identidad"
                    >
                        {{ documentIdType.vc_desc_tipo_doc_identidad }}
                    </mat-option>
                </mat-select>
                <mat-error
                    *ngIf="
                        personalInformationForm
                            .get('personalInformation')
                            .get('documentType')
                            .hasError('required')
                    "
                >
                    Seleccione el tipo de documento
                </mat-error>
            </mat-form-field>

            <!-- Document number field -->
            <div class="md:ml-2 flex w-full col-span-2">
                <mat-form-field class="w-3/4">
                    <input
                        id="documentNumber"
                        matInput
                        placeholder="Nro de documento"
                        [formControlName]="'documentNumber'"
                    />
                    <mat-error
                        *ngIf="
                            personalInformationForm
                                .get('personalInformation')
                                .get('documentNumber')
                                .hasError('required')
                        "
                    >
                        Ingrese el número de documento
                    </mat-error>
                </mat-form-field>
                <button
                    mat-icon-button
                    color="primary"
                    class="ml-2"
                    type="button"
                    (click)="getNameByDNI()"
                >
                    <mat-icon svgIcon="heroicons_outline:search"></mat-icon>
                </button>
            </div>
        </div>
        <!-- Name field -->
        <mat-form-field class="w-full">
            <input
                id="name"
                matInput
                placeholder="Nombre"
                [formControlName]="'name'"
            />
            <mat-error
                *ngIf="
                    personalInformationForm
                        .get('personalInformation')
                        .get('name')
                        .hasError('required')
                "
            >
                Ingrese su nombre
            </mat-error>
        </mat-form-field>

        <!-- Email field -->
        <mat-form-field class="w-full">
            <input
                id="email"
                matInput
                placeholder="Correo electrónico"
                [formControlName]="'email'"
            />
            <mat-error
                *ngIf="
                    personalInformationForm
                        .get('personalInformation')
                        .get('email')
                        .hasError('required')
                "
            >
                Ingrese su correo electrónico
            </mat-error>
            <mat-error
                *ngIf="
                    personalInformationForm
                        .get('personalInformation')
                        .get('email')
                        .hasError('email')
                "
            >
                Ingrese un correo electrónico válido
            </mat-error>
        </mat-form-field>

        <!-- Birth date field -->
        <mat-form-field class="w-full">
            <input
                id="birthDate"
                matInput
                placeholder="Fecha de nacimiento"
                [formControlName]="'birthDate'"
                [matDatepicker]="picker"
                [max]="today"
            />
            <mat-datepicker-toggle
                matSuffix
                [for]="picker"
            ></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error
                *ngIf="
                    personalInformationForm
                        .get('personalInformation')
                        .get('birthDate')
                        .hasError('required')
                "
            >
                Seleccione su fecha de nacimiento
            </mat-error>
        </mat-form-field>

        <!-- Cellphone field -->
        <mat-form-field class="w-full">
            <input
                id="cellphone"
                matInput
                placeholder="Número de celular"
                [formControlName]="'cellphone'"
            />
            <mat-error
                *ngIf="
                    personalInformationForm
                        .get('personalInformation')
                        .get('cellphone')
                        .hasError('required')
                "
            >
                Ingrese número de celular
            </mat-error>
        </mat-form-field>

        <!-- Password field -->
        <mat-form-field class="w-full">
            <input
                id="password"
                matInput
                type="password"
                placeholder="Contraseña"
                [formControlName]="'password'"
                #passwordField
            />
            <button
                mat-icon-button
                type="button"
                (click)="
                    passwordField.type === 'password'
                        ? (passwordField.type = 'text')
                        : (passwordField.type = 'password')
                "
                matSuffix
            >
                <mat-icon
                    class="icon-size-5"
                    *ngIf="passwordField.type === 'password'"
                    [svgIcon]="'heroicons_solid:eye'"
                ></mat-icon>
                <mat-icon
                    class="icon-size-5"
                    *ngIf="passwordField.type === 'text'"
                    [svgIcon]="'heroicons_solid:eye-off'"
                ></mat-icon>
            </button>
            <mat-error> Ingrese su contraseña </mat-error>
        </mat-form-field>

        <!-- Submit button -->
        <div class="flex justify-end">
            <button
                class="fuse-mat-button-large w-full md:w-1/3 mt-6"
                mat-flat-button
                type="submit"
                [color]="'primary'"
                [disabled]="personalInformationForm.disabled"
                (click)="nextStep()"
            >
                <span *ngIf="!personalInformationForm.disabled">
                    Siguiente
                </span>
                <mat-progress-spinner
                    *ngIf="personalInformationForm.disabled"
                    [diameter]="24"
                    [mode]="'indeterminate'"
                ></mat-progress-spinner>
            </button>
        </div>
    </div>
</form>
